# 技术文档：基于 Flask 的旅游景区数据分析与推荐系统

## 1. 项目概述

本项目是一个基于 **Flask** 框架的 Web 应用，主要用于管理和展示与旅游景区相关的数据分析与推荐系统。系统涵盖了用户管理、景区数据分析、评论管理、情感分析、地图展示等多个模块，旨在为用户提供景区数据的可视化展示和个性化推荐。

### 1.1 主要功能
- **用户管理**：用户注册、登录、登出、个人资料编辑、密码修改等功能。
- **景区数据分析**：展示景区的评论数、评分、地理位置等信息，并提供推荐系统。
- **情感分析**：通过微博评论数据进行情感分析，展示情感分布、性别分布、时间序列分析等。
- **地图展示**：根据用户的位置推荐附近的景点，展示景点的地理位置和评论数据。
- **公告管理**：管理员可以发布、编辑和删除公告，公告内容保存在 JSON 文件中。

### 1.2 技术栈
- **前端**：HTML、CSS、JavaScript、ECharts
- **后端**：Flask、SQLAlchemy、MySQL
- **数据分析**：Pandas、SnowNLP
- **地图展示**：ECharts、Geopy
- **其他工具**：Flask-Admin、Flask-Babel、MySQL Connector

---

## 2. 项目结构

### 2.1 项目目录结构
```
project/
├── app.py                  # 主应用文件
├── models.py               # 数据库模型定义
├── analy/                  # 景区数据分析模块
│   ├── map.py              # 地图展示与景区数据统计
│   ├── cityname.py         # 城市景区数据分析
│   ├── districtname.py     # 区县景区数据分析
│   └── recomend.py         # 景区推荐系统
├── emotion/                # 情感分析模块
│   ├── search.py           # 微博评论抓取与情感分析
│   ├── searchecharts.py    # 情感分析图表展示
│   └── searchmap.py        # 地图数据展示
├── manage/                 # 用户管理模块
│   └── login.py            # 用户登录、注册、个人资料管理
├── templates/              # HTML 模板文件
│   ├── index.html          # 主页模板
│   ├── login.html          # 登录页面模板
│   ├── register.html       # 注册页面模板
│   └── ...                 # 其他模板文件
├── static/                 # 静态资源文件
│   ├── css/                # CSS 样式文件
│   ├── js/                 # JavaScript 脚本文件
│   └── images/             # 图片资源
└── requirements.txt        # 项目依赖文件
```

### 2.2 主要文件说明
- **app.py**：Flask 应用的入口文件，负责初始化应用、配置数据库、注册蓝图、设置错误处理等。
- **models.py**：定义数据库模型（如用户、微博评论、景点等）及其对应的 Flask-Admin 管理视图。
- **analy/ 目录**：包含与景区数据分析相关的模块，如地图展示、城市和区县数据统计、推荐系统等。
- **emotion/ 目录**：包含与情感分析相关的模块，如微博评论的情感分析、词云分析、地图数据展示等。
- **manage/ 目录**：包含用户管理相关的模块，如登录、注册、个人资料管理、公告管理等。

---

## 3. 数据库设计

### 3.1 数据库表结构
#### 用户表 (`User`)
| 字段名         | 类型         | 说明               |
| -------------- | ------------ | ------------------ |
| id             | Integer      | 主键，用户唯一标识 |
| username       | String(50)   | 用户名             |
| password       | String(100)  | 密码               |
| role           | Enum         | 用户角色（admin/user） |
| email          | String(100)  | 邮箱               |
| full_name      | String(100)  | 姓名               |
| address        | String(200)  | 地址               |
| phone_number   | String(20)   | 电话号码           |
| birthday       | Date         | 生日               |

#### 微博评论表 (`WeiboComments`)
| 字段名           | 类型         | 说明               |
| ---------------- | ------------ | ------------------ |
| id               | Integer      | 主键，评论唯一标识 |
| topic_index      | Integer      | 话题索引           |
| topic            | String(255)  | 话题名称           |
| mid              | String(255)  | 微博 ID            |
| comment_index    | Integer      | 评论索引           |
| created_at       | DateTime     | 评论创建时间       |
| user_id          | String(255)  | 用户 ID            |
| text             | Text         | 评论内容           |
| source           | String(255)  | 评论来源           |
| screen_name      | String(255)  | 用户昵称           |
| followers_count  | Integer      | 粉丝数             |
| statuses_count   | Integer      | 发布微博数         |
| gender           | String(10)   | 性别               |
| like_count       | Integer      | 点赞数             |
| total_number     | Integer      | 评论数             |
| sentiment        | String(10)   | 情感分类           |
| sentiment_score  | Float        | 情感得分           |

#### 景点表 (`Attractions`)
| 字段名           | 类型         | 说明               |
| ---------------- | ------------ | ------------------ |
| id               | Integer      | 主键，景点唯一标识 |
| external_id      | Integer      | 外部 ID            |
| code             | String(255)  | 编码               |
| word             | String(255)  | 景点名称           |
| eName            | String(255)  | 英文名             |
| type             | String(50)   | 类型               |
| productId        | Integer      | 产品 ID            |
| url              | String(255)  | URL                |
| lat              | Float        | 纬度               |
| lon              | Float        | 经度               |
| cityId           | Integer      | 城市 ID            |
| cityName         | String(255)  | 城市名称           |
| districtId       | Integer      | 区 ID              |
| districtName     | String(255)  | 区名称             |
| poiId            | Integer      | POI ID             |
| alias            | String(255)  | 别名               |
| commentCount     | Integer      | 评论数             |
| commentScore     | Float        | 评分               |
| recommend        | String(50)   | 推荐               |
| address          | Text         | 地址               |

---

## 4. 核心模块实现

### 4.1 用户管理模块 (`manage/login.py`)
- **功能**：用户注册、登录、登出、个人资料编辑、密码修改等。
- **实现**：
  - 使用 Flask 的 `session` 管理用户登录状态。
  - 通过 SQLAlchemy 与 MySQL 数据库交互，存储用户信息。
  - 管理员可以发送消息、发布公告、管理公告等。

### 4.2 景区数据分析模块 (`analy/`)
- **功能**：展示景区的评论数、评分、地理位置等信息，并提供推荐系统。
- **实现**：
  - 使用 MySQL 数据库查询景区数据。
  - 通过 ECharts 进行数据可视化，展示景区数据。
  - 根据用户的位置推荐附近的景点。

### 4.3 情感分析模块 (`emotion/`)
- **功能**：通过微博评论数据进行情感分析，展示情感分布、性别分布、时间序列分析等。
- **实现**：
  - 使用 SnowNLP 进行情感分析。
  - 通过 ECharts 展示情感分析结果。

### 4.4 地图展示模块 (`emotion/searchmap.py`)
- **功能**：展示与微博评论相关的地图数据，根据选定的话题或“全部”选项生成地图上的数据点。
- **实现**：
  - 使用 ECharts 进行地图数据展示。
  - 根据用户的位置推荐附近的景点。

---

## 5. 部署与运行

### 5.1 环境配置
1. 安装 Python 3.9+。
2. 安装项目依赖：
   ```bash
   pip install -r requirements.txt
   ```
3. 配置 MySQL 数据库，创建 `travel` 数据库，并导入表结构。

### 5.2 运行项目
1. 启动 Flask 应用：
   ```bash
   python app.py
   ```
2. 访问 `http://localhost:5000` 查看应用。

---
